<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Markdown</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./imatges/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./imatges/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./imatges/favicon-16x16.png">
    <link rel="manifest" href="./imatges/site.webmanifest">
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
     <link href="./output.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 h-screen">
    <div class="flex flex-col h-full">
        <!-- Header -->
        <div class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700">
            <div class="flex items-center justify-between px-4 py-3">
                <h1 class="text-xl font-bold text-gray-800 dark:text-gray-100">Editor de Markdown</h1>
                <div class="flex gap-2">
                    <button onclick="togglePreview()" 
                            class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm"
                            data-tooltip="Canviar tema">
                        <span id="previewToggleText">ğŸ‘ï¸ Amagar vista</span>
                    </button>
                    <button onclick="importFile()" 
                            class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"
                            data-tooltip="Obrir fitxer (Ctrl+O)">
                        ğŸ“ Obrir
                    </button>
                    <button onclick="exportFile()" 
                            class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm"
                            data-tooltip="Desar fitxer (Ctrl+S)">
                        ğŸ’¾ Desar
                    </button>
                    <button onclick="showLocalStorageManager()" 
                            class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm"
                            data-tooltip="Gestionar documents guardats">
                        ğŸ“‹ Gestionar
                    </button>
                    <button onclick="clearEditor()" 
                            class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"
                            data-tooltip="Netejar tot l'editor">
                        ğŸ—‘ï¸ Netejar
                    </button>
                    <button id="themeToggle" 
                            onclick="toggleTheme()" 
                            class="px-3 py-1 bg-gray-600 dark:bg-gray-700 text-white rounded hover:bg-gray-700 dark:hover:bg-gray-600 text-sm"
                            data-tooltip="Canviar tema">
                        ğŸŒ™ Tema fosc
                    </button>
                </div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 px-4 py-2">
            <div class="flex flex-wrap gap-1">
                <!-- MenÃº desplegable per tÃ­tols (substitueix els botons H1, H2, H3) -->
                <div class="relative dropdown">
                    <button class="toolbar-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center gap-1"
                            data-tooltip="Inserir tÃ­tol"
                            onclick="toggleDropdown('headingDropdown')">
                        <span class="font-bold dark:text-gray-200 text-2xl">H</span>
                        <svg class="w-3 h-3 dark:text-gray-200 text-2xl" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    
                    <div id="headingDropdown" 
                        class="dropdown-content absolute top-full left-0 mt-1 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md shadow-lg z-50 min-w-[160px] hidden">
                        <button onclick="insertText('# '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold text-2xl">H1</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol principal</span>
                        </button>
                        <button onclick="insertText('## '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold text-xl">H2</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol secundari</span>
                        </button>
                        <button onclick="insertText('### '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold text-lg">H3</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol terciari</span>
                        </button>
                        <button onclick="insertText('#### '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold">H4</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol quaternari</span>
                        </button>
                        <button onclick="insertText('##### '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold text-sm">H5</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol cinquÃ¨</span>
                        </button>
                        <button onclick="insertText('###### '); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="font-bold text-xs">H6</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">TÃ­tol sisÃ¨</span>
                        </button>
                        <hr class="border-gray-200 dark:border-gray-600">
                        <button onclick="insertText('\n'); closeDropdown('headingDropdown')" 
                                class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-200 flex items-center gap-2">
                            <span class="text-sm">P</span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">ParÃ graf normal</span>
                        </button>
                        
                    </div>
                </div>
                <!--
                <button onclick="insertText('# ')" 
                        class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 1"
                        data-tooltip="TÃ­tol principal (H1)">
                    <span class="font-bold text-2xl dark:text-gray-200">H1</span>
                </button>
                <button onclick="insertText('## ')" 
                        class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 2"
                        data-tooltip="TÃ­tol secundari (H2)">
                    <span class="font-bold text-xl dark:text-gray-200">H2</span>
                </button>
                <button onclick="insertText('### ')" 
                        class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 3"
                        data-tooltip="TÃ­tol terciari (H3)">
                    <span class="font-bold text-lg dark:text-gray-200">H3</span>
                </button>
                <button onclick="insertText('#### ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 4"
                        data-tooltip="TÃ­tol quart (H4)">
                    <span class="font-bold text-base dark:text-gray-200">H4</span>
                </button>
                <button onclick="insertText('##### ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 5"
                        data-tooltip="TÃ­tol cinquÃ¨ (H5)">
                    <span class="font-bold text-sm dark:text-gray-200">H5</span>
                </button>
                <button onclick="insertText('###### ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="TÃ­tol 6"
                        data-tooltip="TÃ­tol sisÃ¨ (H6)">
                    <span class="font-bold text-xs dark:text-gray-200">H6</span>
                </button>
                -->
                <div class="border-l mx-2"></div>
                <button onclick="wrapText('**', '**')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-bold" 
                        title="Negreta"
                        data-tooltip="Text en negreta">
                    <span class="font-bold  text-lg dark:text-gray-200">B</span>
                </button>
                <button onclick="wrapText('*', '*')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded italic" 
                        title="Cursiva"
                        data-tooltip="Text en cursiva">
                    <span class="italic text-lg dark:text-gray-200">I</span>
                </button>
                <button onclick="wrapText('~~', '~~')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded line-through" 
                    title="Ratllat"
                    data-tooltip="Text ratllat">
                    <span class="line-through text-lg dark:text-gray-200">S</span>
                </button>
                <div class="border-l mx-2"></div>
                <button onclick="insertText('---\n')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="LÃ­nia horitzontal"
                        data-tooltip="LÃ­nia horitzontal">
                    <span class="font-bold text-lg dark:text-gray-200">â€”</span>
                </button>
                <button onclick="insertText('> ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Cita"
                        data-tooltip="Cita">
                    <span class="font-bold text-lg dark:text-gray-200">""</span>
                </button>
                <div class="border-l mx-2"></div>
                <button onclick="insertText('- ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Llista"
                        data-tooltip="Llista no numerada">
                    <span class="font-bold text-lg dark:text-gray-200">â€¢ â‰¡</span>
                </button>
                <button onclick="insertText('1. ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Llista numerada"
                        data-tooltip="Llista numerada">
                    <span class="font-bold text-lg dark:text-gray-200">1. â‰¡</span>
                </button>
                <button onclick="insertText('- [ ] ')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Llista de tasques"
                        data-tooltip="Llista de tasques">
                    <span class="font-bold text-lg dark:text-gray-200">â˜ â‰¡</span>
                </button>
                <div class="border-l mx-2"></div>
                <button onclick="insertText('| Columna 1 | Columna 2 |\n|----------|----------|\n| CelÂ·la 1 | CelÂ·la 2 |\n')" 
                        class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Taula"
                        data-tooltip="Taula">
                    <span class="font-bold text-lg dark:text-gray-200">âŠ</span>
                </button>
                <button onclick="wrapText('[', '](url)')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="EnllaÃ§"
                        >
                    <span class="font-bold text-lg dark:text-gray-200">ğŸ”—</span>
                </button>
                <button onclick="insertImage()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Inserir imatge"
                        data-tooltip="Inserir imatge">
                    <span class="font-bold text-lg dark:text-gray-200">ğŸ–¼ï¸</span>
                </button>
                <button onclick="wrapText('`', '`')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Codi inline"
                        data-tooltip="Codi inline">
                    <span class="font-bold text-lg dark:text-gray-200">&lt;/&gt;</span>
                </button>
                <button onclick="insertText('```\n\n```\n')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" 
                        title="Bloc de codi"
                        data-tooltip="Bloc de codi">
                    <span class="font-bold text-lg dark:text-gray-200">â‹¯</span>
                </button>
                <!-- BotÃ³ dropdown per emojis (afegir a la toolbar) -->
                <div class="relative dropdown">
                    <button class="toolbar-btn p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center gap-1"
                            data-tooltip="Inserir emoji"
                            onclick="toggleDropdown('emojiDropdown')">
                        <span class="dark:text-gray-200">ğŸ˜€</span>
                        <svg class="w-3 h-3 dark:text-gray-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    
                    <div id="emojiDropdown" 
                    class="dropdown-content absolute top-full left-0 mt-1 bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-md shadow-lg z-50 w-80 max-h-80 overflow-y-auto hidden">
                        <div class="p-2">
                            <div class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">Expressions</div>
                            <div class="grid grid-cols-8 gap-1 mb-3">
                                <button onclick="insertText('ğŸ˜€'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":grinning:">ğŸ˜€</button>
                                <button onclick="insertText('ğŸ˜„'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":smile:">ğŸ˜„</button>
                                <button onclick="insertText('ğŸ˜‚'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":joy:">ğŸ˜‚</button>
                                <button onclick="insertText('ğŸ˜Š'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":blush:">ğŸ˜Š</button>
                                <button onclick="insertText('ğŸ˜'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":heart_eyes:">ğŸ˜</button>
                                <button onclick="insertText('ğŸ˜˜'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":kissing_heart:">ğŸ˜˜</button>
                                <button onclick="insertText('ğŸ˜‰'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":wink:">ğŸ˜‰</button>
                                <button onclick="insertText('ğŸ˜'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":disappointed:">ğŸ˜</button>
                            </div>
                            
                            <div class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">Gestos</div>
                            <div class="grid grid-cols-8 gap-1 mb-3">
                                <button onclick="insertText('ğŸ‘'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":thumbsup:">ğŸ‘</button>
                                <button onclick="insertText('ğŸ‘'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":thumbsdown:">ğŸ‘</button>
                                <button onclick="insertText('ğŸ‘Œ'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":ok_hand:">ğŸ‘Œ</button>
                                <button onclick="insertText('ğŸ‘'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":clap:">ğŸ‘</button>
                                <button onclick="insertText('ğŸ™'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":pray:">ğŸ™</button>
                                <button onclick="insertText('ğŸ’ª'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":muscle:">ğŸ’ª</button>
                                <button onclick="insertText('ğŸ‘‹'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":wave:">ğŸ‘‹</button>
                                <button onclick="insertText('âœ‹'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":raised_hand:">âœ‹</button>
                            </div>
                            
                            <div class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">SÃ­mbols</div>
                            <div class="grid grid-cols-8 gap-1 mb-3">
                                <button onclick="insertText('âš ï¸'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":warning:">âš ï¸</button>
                                <button onclick="insertText('â—'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":exclamation:">â—</button>
                                <button onclick="insertText('â“'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":question:">â“</button>
                                <button onclick="insertText('âœ…'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":white_check_mark:">âœ…</button>
                                <button onclick="insertText('âŒ'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":x:">âŒ</button>
                                <button onclick="insertText('ğŸ’¡'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":bulb:">ğŸ’¡</button>
                                <button onclick="insertText('ğŸ”¥'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":fire:">ğŸ”¥</button>
                                <button onclick="insertText('ğŸš€'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":rocket:">ğŸš€</button>
                            </div>
                            
                            <div class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">ProgramaciÃ³</div>
                            <div class="grid grid-cols-8 gap-1">
                                <button onclick="insertText('ğŸ›'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":bug:">ğŸ›</button>
                                <button onclick="insertText('ğŸš§'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":construction:">ğŸš§</button>
                                <button onclick="insertText('ğŸ“'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":memo:">ğŸ“</button>
                                <button onclick="insertText('ğŸ“'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":file_folder:">ğŸ“</button>
                                <button onclick="insertText('ğŸ’»'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":computer:">ğŸ’»</button>
                                <button onclick="insertText('ğŸ”'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":mag:">ğŸ”</button>
                                <button onclick="insertText('âš™ï¸'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":gear:">âš™ï¸</button>
                                <button onclick="insertText('ğŸ”§'); closeDropdown('emojiDropdown')" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" title=":wrench:">ğŸ”§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div id="mainContent" class="flex flex-col lg:flex-row flex-1 overflow-hidden relative">
            <!-- Drag overlay -->
            <div id="dragOverlay" class="drag-overlay hidden">
                <div class="text-center text-blue-600">
                    <div class="text-4xl mb-4">ğŸ“„</div>
                    <div class="text-xl font-semibold">Deixa el fitxer Markdown aquÃ­</div>
                    <div class="text-sm opacity-75 mt-2">Formats suportats: .md, .txt</div>
                </div>
            </div>
            
            <!-- Editor -->
            <div id="editorContainer" class="w-full lg:w-1/2 bg-white dark:bg-gray-800 border-r dark:border-gray-700 transition-all duration-300 flex flex-col min-h-0">
                <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex-shrink-0">
                    <h2 class="font-semibold text-gray-700 dark:text-gray-200">Editor</h2>
                </div>
                <textarea
                    id="editor"
                    class="w-full flex-1 p-4 border-none outline-none resize-none editor-textarea min-h-[60vh] lg:min-h-0 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"
                    placeholder="Escriu el teu Markdown aquÃ­ o arrossega un fitxer..."
                    oninput="updatePreview()"
                ></textarea>
            </div>

            <!-- Preview -->
            <div id="previewContainer" class="w-full lg:w-1/2 bg-white dark:bg-gray-800 transition-all duration-300 flex flex-col min-h-0">
                <div class="p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex-shrink-0">
                    <h2 class="font-semibold text-gray-700 dark:text-gray-200">Vista prÃ¨via</h2>
                </div>
                <div id="preview" class="p-4 overflow-y-auto flex-1 preview-content min-h-[40vh] lg:min-h-0 dark:text-gray-100"></div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <!-- <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-50 flex items-center justify-center">
        <div id="modalContent" class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-96 overflow-y-auto"> -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center">
        <div id="modalContent" class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-96 overflow-y-auto">
            <!-- Modal content will be inserted here -->
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".md,.txt" style="display: none;" onchange="handleFileImport(event)">

    <script>
        // Variables globals
        let currentFileName = 'document.md';
        let currentModalResolve = null;
        let previewVisible = true;
        let isDragging = false;

        // Variables per al tema
let isDarkMode = false;

function initializeTheme() {
    // Comprovar preferÃ¨ncia guardada
    console.log("ğŸš€ ~ initializeTheme ~ "

    )
    const savedTheme = localStorage.getItem('markdownEditorTheme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    // Aplicar tema guardat o preferÃ¨ncia del sistema
    isDarkMode = savedTheme === 'dark' || (savedTheme === null && prefersDark);
    applyTheme();
    updateThemeButton();
}
    

// Alternar entre tema fosc i clar
function toggleTheme() {

    isDarkMode = !isDarkMode;
    
    applyTheme();
    updateThemeButton();
    
    // Guardar preferÃ¨ncia
    localStorage.setItem('markdownEditorTheme', isDarkMode ? 'dark' : 'light');
}

// Aplicar el tema seleccionat
function applyTheme() {
    // const html = document.documentElement;
    
    // if (isDarkMode) {
    //     html.classList.add('dark');
    // } else {
    //     html.classList.remove('dark');
    // }
        const body = document.documentElement;
    
    if (isDarkMode) {
        body.classList.add('dark');
    } else {
        body.classList.remove('dark');
    }
}

// Actualitzar text i icona del botÃ³ de tema
function updateThemeButton() {
    const themeButton = document.getElementById('themeToggle');
    if (themeButton) {
        const icon = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
        const text = isDarkMode ? 'Tema clar' : 'Tema fosc';
        themeButton.innerHTML = `${icon} ${text}`;
    }
}

        // Funcions del modal
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        // Alternar vista prÃ¨via
        function togglePreview() {
            const editorContainer = document.getElementById('editorContainer');
            const previewContainer = document.getElementById('previewContainer');
            const toggleText = document.getElementById('previewToggleText');
            const mainContent = document.getElementById('mainContent');
            const editor = document.getElementById('editor');
            
            previewVisible = !previewVisible;
            
            if (previewVisible) {
                // Mostrar vista prÃ¨via
                previewContainer.classList.remove('hidden');
                toggleText.textContent = 'ğŸ‘ï¸ Amagar vista';
                
                // Responsive: En mÃ²bil (lg:) dividir verticalment, en desktop horitzontalment
                editorContainer.className = 'w-full lg:w-1/2 bg-white border-r transition-all duration-300 flex flex-col min-h-0';
                previewContainer.className = 'w-full lg:w-1/2 bg-white transition-all duration-300 flex flex-col min-h-0';
                mainContent.className = 'flex flex-col lg:flex-row flex-1 overflow-hidden relative';
                editor.className = 'w-full flex-1 p-4 border-none outline-none resize-none editor-textarea min-h-[60vh] lg:min-h-0';
            } else {
                // Amagar vista prÃ¨via
                previewContainer.classList.add('hidden');
                toggleText.textContent = 'ğŸ‘ï¸ Mostrar vista';
                
                // Editor a pantalla completa
                editorContainer.className = 'w-full bg-white transition-all duration-300 flex flex-col min-h-0';
                mainContent.className = 'flex flex-1 overflow-hidden relative';
                editor.className = 'w-full flex-1 p-4 border-none outline-none resize-none editor-textarea';
            }
        }

        function showAlert(message, type = 'info') {
            return new Promise((resolve) => {
                const iconMap = {
                    'info': 'ğŸ’¡',
                    'success': 'âœ…', 
                    'warning': 'âš ï¸',
                    'error': 'âŒ'
                };
                
                const colorMap = {
                    'info': 'bg-blue-100 text-blue-800 border-blue-300',
                    'success': 'bg-green-100 text-green-800 border-green-300',
                    'warning': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    'error': 'bg-red-100 text-red-800 border-red-300'
                };

                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">${iconMap[type]}</span>
                            <h3 class="text-lg font-semibold text-gray-800">InformaciÃ³</h3>
                        </div>
                        <div class="mb-6 p-3 rounded border ${colorMap[type]}">
                            ${message}
                        </div>
                        <div class="flex justify-end">
                            <button onclick="resolveModal(true)" 
                                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                                D'acord
                            </button>
                        </div>
                    </div>
                `;
                
                currentModalResolve = resolve;
                showModal(content);
            });
        }

        function showConfirm(message, confirmText = 'Acceptar', cancelText = 'CancelÂ·lar') {
            return new Promise((resolve) => {
                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">â“</span>
                            <h3 class="text-lg font-semibold text-gray-800">ConfirmaciÃ³</h3>
                        </div>
                        <div class="mb-6 text-gray-700">
                            ${message}
                        </div>
                        <div class="flex justify-end gap-3">
                            <button onclick="resolveModal(false)" 
                                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                                ${cancelText}
                            </button>
                            <button onclick="resolveModal(true)" 
                                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                                ${confirmText}
                            </button>
                        </div>
                    </div>
                `;
                
                currentModalResolve = resolve;
                showModal(content);
            });
        }

        function showPrompt(message, defaultValue = '', placeholder = '') {
            return new Promise((resolve) => {
                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">âœï¸</span>
                            <h3 class="text-lg font-semibold text-gray-800">Entrada requerida</h3>
                        </div>
                        <div class="mb-4 text-gray-700">
                            ${message}
                        </div>
                        <input type="text" id="promptInput" value="${defaultValue}" placeholder="${placeholder}"
                               class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-6">
                        <div class="flex justify-end gap-3">
                            <button onclick="resolveModal(null)" 
                                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                                CancelÂ·lar
                            </button>
                            <button onclick="resolveModal(document.getElementById('promptInput').value)" 
                                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                                Acceptar
                            </button>
                        </div>
                    </div>
                `;
                
                currentModalResolve = resolve;
                showModal(content);
                
                // Focus en l'input i seleccionar text
                setTimeout(() => {
                    const input = document.getElementById('promptInput');
                    if (input) {
                        input.focus();
                        input.select();
                        
                        // Enter per acceptar
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                resolveModal(input.value);
                            }
                        });
                    }
                }, 100);
            });
        }

        function showLocationChoice(message, option1 = 'Disc dur', option2 = 'Local Storage') {
            return new Promise((resolve) => {
                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">ğŸ“</span>
                            <h3 class="text-lg font-semibold text-gray-800">Triar ubicaciÃ³</h3>
                        </div>
                        <div class="mb-6 text-gray-700">
                            ${message}
                        </div>
                        <div class="flex flex-col gap-3">
                            <button onclick="resolveModal('disk')" 
                                    class="flex items-center p-4 border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                                <span class="text-2xl mr-3">ğŸ’¾</span>
                                <div class="text-left">
                                    <div class="font-semibold">${option1}</div>
                                    <div class="text-sm text-gray-600">Desar/obrir fitxers al teu ordinador</div>
                                </div>
                            </button>
                            <button onclick="resolveModal('storage')" 
                                    class="flex items-center p-4 border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                                <span class="text-2xl mr-3">ğŸ—„ï¸</span>
                                <div class="text-left">
                                    <div class="font-semibold">${option2}</div>
                                    <div class="text-sm text-gray-600">Desar/obrir del navegador (local)</div>
                                </div>
                            </button>
                        </div>
                        <div class="flex justify-end mt-4">
                            <button onclick="resolveModal(null)" 
                                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                                CancelÂ·lar
                            </button>
                        </div>
                    </div>
                `;
                
                currentModalResolve = resolve;
                showModal(content);
            });
        }

        // FunciÃ³ per inserir imatges
async function insertImage() {
    try {
        // Demanar URL de la imatge
        const imageUrl = await showPrompt(
            'Introdueix l\'URL de la imatge:', 
            '', 
            'https://example.com/imatge.jpg'
        );
        
        if (!imageUrl) return; // L'usuari ha cancelÂ·lat
        
        // Validar que sembli una URL vÃ lida
        if (!isValidUrl(imageUrl)) {
            await showAlert('L\'URL introduÃ¯da no sembla vÃ lida. Assegura\'t que comenci per http:// o https://', 'warning');
            return;
        }
        
        // Demanar descripciÃ³/text alternatiu
        const altText = await showPrompt(
            'Introdueix una descripciÃ³ per la imatge (text alternatiu):', 
            '', 
            'DescripciÃ³ de la imatge'
        );
        
        if (altText === null) return; // L'usuari ha cancelÂ·lat
        
        // Crear la marca Markdown per la imatge
        const markdownImage = `![${altText || 'Imatge'}](${imageUrl})`;
        
        // Inserir al editor
        insertText(markdownImage);
        
        await showAlert('Imatge inserida correctament!', 'success');
        
    } catch (error) {
        await showAlert('Error en inserir la imatge: ' + error.message, 'error');
    }
}

// FunciÃ³ auxiliar per validar URLs
function isValidUrl(string) {
    try {
        const url = new URL(string);
        return url.protocol === 'http:' || url.protocol === 'https:';
    } catch (_) {
        return false;
    }
}

        // Tancar modal fent clic fora
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                resolveModal(null);
            }
        });

        // Tancar modal amb Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !document.getElementById('modalOverlay').classList.contains('hidden')) {
                resolveModal(null);
            }
        });

        // Configurar drag & drop
function setupDragAndDrop() {
    const editor = document.getElementById('editor');
    const dragOverlay = document.getElementById('dragOverlay');
    const mainContent = document.getElementById('mainContent');
    
    // Evitar el comportament per defecte del navegador
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        mainContent.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    // Mostrar overlay quan s'arrossega sobre l'Ã rea
    ['dragenter', 'dragover'].forEach(eventName => {
        mainContent.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        mainContent.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        if (!isDragging) {
            isDragging = true;
            dragOverlay.classList.remove('hidden');
        }
    }
    
    function unhighlight() {
        isDragging = false;
        dragOverlay.classList.add('hidden');
    }
    
    // Gestionar l'arxiu quan es deixa anar
    mainContent.addEventListener('drop', handleDrop, false);
    
    async function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            const file = files[0];
            
            // Comprovar si Ã©s un fitxer de text vÃ lid
            if (file.type === 'text/markdown' || file.type === 'text/plain' || 
                file.name.endsWith('.md') || file.name.endsWith('.txt')) {
                
                // Comprovar si l'editor tÃ© contingut
                const currentContent = editor.value.trim();
                let shouldReplace = true;
                
                if (currentContent) {
                    shouldReplace = await showConfirm(
                        `L'editor ja tÃ© contingut. Vols substituir-lo pel contingut del fitxer "${file.name}"?<br><br>` +
                        'âš ï¸ <strong>AtenciÃ³:</strong> El contingut actual es perdrÃ  si no l\'has desat.',
                        'SÃ­, substituir',
                        'CancelÂ·lar'
                    );
                }
                
                if (shouldReplace) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        editor.value = e.target.result;
                        updatePreview();
                        currentFileName = file.name;
                        await showAlert(`Fitxer "${file.name}" carregat correctament mitjanÃ§ant drag & drop.`, 'success');
                    };
                    reader.onerror = async function() {
                        await showAlert('Error en llegir el fitxer.', 'error');
                    };
                    reader.readAsText(file);
                }
            } else {
                await showAlert(
                    'Tipus de fitxer no suportat.<br><br>' +
                    'ğŸ“„ <strong>Formats acceptats:</strong> .md, .txt', 
                    'warning'
                );
            }
        }
    }
}

// Sistema de tooltips avanÃ§at (opcional)
class TooltipManager {
    constructor() {
        this.tooltip = null;
        this.init();
    }

    init() {
        // Crear element tooltip
        this.tooltip = document.createElement('div');
        this.tooltip.className = 'tooltip-advanced';
        this.tooltip.style.cssText = `
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 9999;
            white-space: nowrap;
        `;
        document.body.appendChild(this.tooltip);

        // Afegir listeners
        this.addEventListeners();
    }

    addEventListeners() {
        document.addEventListener('mouseover', (e) => {
            const target = e.target.closest('[data-tooltip]');
            if (target) {
                this.show(target, target.getAttribute('data-tooltip'));
            }
        });

        document.addEventListener('mouseout', (e) => {
            const target = e.target.closest('[data-tooltip]');
            if (target) {
                this.hide();
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (this.tooltip.style.opacity === '1') {
                this.position(e);
            }
        });
    }

    show(element, text) {
        this.tooltip.textContent = text;
        this.tooltip.style.opacity = '1';
    }

    hide() {
        this.tooltip.style.opacity = '0';
    }

    position(event) {
        const tooltip = this.tooltip;
        const x = event.clientX;
        const y = event.clientY;
        
        // Posicionar tooltip
        tooltip.style.left = (x + 10) + 'px';
        tooltip.style.top = (y - 30) + 'px';

        // Ajustar si surt de la pantalla
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
            tooltip.style.left = (x - rect.width - 10) + 'px';
        }
        if (rect.top < 0) {
            tooltip.style.top = (y + 20) + 'px';
        }
    }
}

// Funcions per gestionar el dropdown
function toggleDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    const button = dropdown.previousElementSibling;
    const parentDropdown = button.closest('.dropdown');
    
    // Tancar altres dropdowns oberts
    document.querySelectorAll('.dropdown-content.show').forEach(dd => {
        if (dd.id !== dropdownId) {
            dd.classList.remove('show');
            dd.closest('.dropdown').classList.remove('open');
        }
    });
    
    // Alternar el dropdown actual
    if (dropdown.classList.contains('show')) {
        closeDropdown(dropdownId);
    } else {
        openDropdown(dropdownId);
    }
}

function openDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    const parentDropdown = dropdown.closest('.dropdown');
    
    dropdown.classList.add('show');
    parentDropdown.classList.add('open');
    
    // Ajustar posiciÃ³ si surt de la pantalla
    setTimeout(() => {
        const rect = dropdown.getBoundingClientRect();
        const windowWidth = window.innerWidth;
        
        if (rect.right > windowWidth - 10) {
            dropdown.style.left = 'auto';
            dropdown.style.right = '0';
        }
    }, 10);
}

function closeDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    const parentDropdown = dropdown.closest('.dropdown');
    
    dropdown.classList.remove('show');
    parentDropdown.classList.remove('open');
    
    // Resetar posiciÃ³
    dropdown.style.left = '';
    dropdown.style.right = '';
}

// Tancar dropdown en fer clic fora
document.addEventListener('click', function(event) {
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
        if (!dropdown.contains(event.target)) {
            const dropdownContent = dropdown.querySelector('.dropdown-content');
            if (dropdownContent && dropdownContent.classList.contains('show')) {
                closeDropdown(dropdownContent.id);
            }
        }
    });
});

// Tancar dropdown amb Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.querySelectorAll('.dropdown-content.show').forEach(dropdown => {
            closeDropdown(dropdown.id);
        });
    }
});

// Mapa d'emojis mÃ©s comuns
const emojiMap = {
    // Expressions
    ':smile:': 'ğŸ˜„',
    ':grinning:': 'ğŸ˜€',
    ':joy:': 'ğŸ˜‚',
    ':laughing:': 'ğŸ˜†',
    ':wink:': 'ğŸ˜‰',
    ':blush:': 'ğŸ˜Š',
    ':heart_eyes:': 'ğŸ˜',
    ':kissing_heart:': 'ğŸ˜˜',
    ':relaxed:': 'â˜ºï¸',
    ':satisfied:': 'ğŸ˜Œ',
    ':grin:': 'ğŸ˜',
    ':stuck_out_tongue:': 'ğŸ˜›',
    ':stuck_out_tongue_winking_eye:': 'ğŸ˜œ',
    ':disappointed:': 'ğŸ˜',
    ':worried:': 'ğŸ˜Ÿ',
    ':angry:': 'ğŸ˜ ',
    ':rage:': 'ğŸ˜¡',
    ':cry:': 'ğŸ˜¢',
    ':sob:': 'ğŸ˜­',
    ':fearful:': 'ğŸ˜¨',
    ':tired_face:': 'ğŸ˜«',
    
    // Gestos i mans
    ':thumbsup:': 'ğŸ‘',
    ':thumbsdown:': 'ğŸ‘',
    ':ok_hand:': 'ğŸ‘Œ',
    ':punch:': 'ğŸ‘Š',
    ':fist:': 'âœŠ',
    ':clap:': 'ğŸ‘',
    ':pray:': 'ğŸ™',
    ':point_up:': 'â˜ï¸',
    ':point_down:': 'ğŸ‘‡',
    ':point_left:': 'ğŸ‘ˆ',
    ':point_right:': 'ğŸ‘‰',
    ':raised_hand:': 'âœ‹',
    ':muscle:': 'ğŸ’ª',
    ':wave:': 'ğŸ‘‹',
    
    // Cors i sÃ­mbols
    ':heart:': 'â¤ï¸',
    ':broken_heart:': 'ğŸ’”',
    ':two_hearts:': 'ğŸ’•',
    ':sparkling_heart:': 'ğŸ’–',
    ':heartpulse:': 'ğŸ’—',
    ':blue_heart:': 'ğŸ’™',
    ':green_heart:': 'ğŸ’š',
    ':yellow_heart:': 'ğŸ’›',
    ':purple_heart:': 'ğŸ’œ',
    ':star:': 'â­',
    ':star2:': 'ğŸŒŸ',
    ':sparkles:': 'âœ¨',
    ':fire:': 'ğŸ”¥',
    ':boom:': 'ğŸ’¥',
    
    // AdvertÃ¨ncies i sÃ­mbol
    ':warning:': 'âš ï¸',
    ':exclamation:': 'â—',
    ':question:': 'â“',
    ':grey_exclamation:': 'â•',
    ':grey_question:': 'â”',
    ':x:': 'âŒ',
    ':heavy_check_mark:': 'âœ…',
    ':white_check_mark:': 'âœ…',
    ':o:': 'â­•',
    ':no_entry:': 'â›”',
    ':heavy_multiplication_x:': 'âœ–ï¸',
    ':heavy_plus_sign:': 'â•',
    ':heavy_minus_sign:': 'â–',
    
    // Tecnologia
    ':computer:': 'ğŸ’»',
    ':laptop:': 'ğŸ’»',
    ':phone:': 'ğŸ“±',
    ':iphone:': 'ğŸ“±',
    ':camera:': 'ğŸ“·',
    ':video_camera:': 'ğŸ“¹',
    ':tv:': 'ğŸ“º',
    ':radio:': 'ğŸ“»',
    ':cd:': 'ğŸ’¿',
    ':dvd:': 'ğŸ“€',
    ':floppy_disk:': 'ğŸ’¾',
    ':minidisc:': 'ğŸ’½',
    ':electric_plug:': 'ğŸ”Œ',
    ':battery:': 'ğŸ”‹',
    
    // Objectes i eines
    ':bulb:': 'ğŸ’¡',
    ':gear:': 'âš™ï¸',
    ':wrench:': 'ğŸ”§',
    ':hammer:': 'ğŸ”¨',
    ':nut_and_bolt:': 'ğŸ”©',
    ':hocho:': 'ğŸ”ª',
    ':gun:': 'ğŸ”«',
    ':bomb:': 'ğŸ’£',
    ':key:': 'ğŸ”‘',
    ':lock:': 'ğŸ”’',
    ':unlock:': 'ğŸ”“',
    ':bell:': 'ğŸ””',
    ':bookmark:': 'ğŸ”–',
    ':link:': 'ğŸ”—',
    
    // Transport
    ':car:': 'ğŸš—',
    ':taxi:': 'ğŸš•',
    ':bus:': 'ğŸšŒ',
    ':train:': 'ğŸš‹',
    ':bike:': 'ğŸš´',
    ':airplane:': 'âœˆï¸',
    ':rocket:': 'ğŸš€',
    ':ship:': 'ğŸš¢',
    ':boat:': 'â›µ',
    ':anchor:': 'âš“',
    
    // Natura
    ':sunny:': 'â˜€ï¸',
    ':cloud:': 'â˜ï¸',
    ':umbrella:': 'â˜”',
    ':snowflake:': 'â„ï¸',
    ':snowman:': 'â›„',
    ':zap:': 'âš¡',
    ':cyclone:': 'ğŸŒ€',
    ':ocean:': 'ğŸŒŠ',
    ':earth_americas:': 'ğŸŒ',
    ':earth_africa:': 'ğŸŒ',
    ':earth_asia:': 'ğŸŒ',
    ':new_moon:': 'ğŸŒ‘',
    ':full_moon:': 'ğŸŒ•',
    ':crescent_moon:': 'ğŸŒ™',
    
    // Animals
    ':dog:': 'ğŸ¶',
    ':cat:': 'ğŸ±',
    ':mouse:': 'ğŸ­',
    ':hamster:': 'ğŸ¹',
    ':rabbit:': 'ğŸ°',
    ':bear:': 'ğŸ»',
    ':panda_face:': 'ğŸ¼',
    ':koala:': 'ğŸ¨',
    ':tiger:': 'ğŸ¯',
    ':lion_face:': 'ğŸ¦',
    ':cow:': 'ğŸ®',
    ':pig:': 'ğŸ·',
    ':monkey_face:': 'ğŸµ',
    ':see_no_evil:': 'ğŸ™ˆ',
    ':hear_no_evil:': 'ğŸ™‰',
    ':speak_no_evil:': 'ğŸ™Š',
    
    // Menjar
    ':apple:': 'ğŸ',
    ':banana:': 'ğŸŒ',
    ':grapes:': 'ğŸ‡',
    ':strawberry:': 'ğŸ“',
    ':cherry:': 'ğŸ’',
    ':peach:': 'ğŸ‘',
    ':pizza:': 'ğŸ•',
    ':hamburger:': 'ğŸ”',
    ':fries:': 'ğŸŸ',
    ':hotdog:': 'ğŸŒ­',
    ':beer:': 'ğŸº',
    ':wine_glass:': 'ğŸ·',
    ':coffee:': 'â˜•',
    ':tea:': 'ğŸµ',
    ':birthday:': 'ğŸ‚',
    ':cake:': 'ğŸ°',
    
    // Activitats
    ':soccer:': 'âš½',
    ':basketball:': 'ğŸ€',
    ':football:': 'ğŸˆ',
    ':baseball:': 'âš¾',
    ':tennis:': 'ğŸ¾',
    ':golf:': 'â›³',
    ':trophy:': 'ğŸ†',
    ':medal:': 'ğŸ…',
    ':musical_note:': 'ğŸµ',
    ':notes:': 'ğŸ¶',
    ':headphones:': 'ğŸ§',
    ':microphone:': 'ğŸ¤',
    ':guitar:': 'ğŸ¸',
    ':game_die:': 'ğŸ²',
    ':dart:': 'ğŸ¯',
    
    // Temps i dates
    ':clock1:': 'ğŸ•',
    ':clock2:': 'ğŸ•‘',
    ':clock3:': 'ğŸ•’',
    ':clock12:': 'ğŸ•›',
    ':alarm_clock:': 'â°',
    ':hourglass:': 'âŒ›',
    ':calendar:': 'ğŸ“…',
    ':date:': 'ğŸ“…',
    
    // ProgramaciÃ³ i GitHub
    ':bug:': 'ğŸ›',
    ':construction:': 'ğŸš§',
    ':memo:': 'ğŸ“',
    ':pencil:': 'âœï¸',
    ':pencil2:': 'âœï¸',
    ':page_facing_up:': 'ğŸ“„',
    ':clipboard:': 'ğŸ“‹',
    ':file_folder:': 'ğŸ“',
    ':open_file_folder:': 'ğŸ“‚',
    ':scissors:': 'âœ‚ï¸',
    ':pushpin:': 'ğŸ“Œ',
    ':paperclip:': 'ğŸ“',
    ':mag:': 'ğŸ”',
    ':mag_right:': 'ğŸ”',
};

// FunciÃ³ per convertir text amb emojis
function convertEmojis(text) {
    // Buscar totes les coincidÃ¨ncies de :emoji_name:
    return text.replace(/:[\w+-]+:/g, function(match) {
        const emoji = emojiMap[match];
        return emoji || match; // Si no existeix l'emoji, mantenir el text original
    });
}

// Actualitzar la funciÃ³ updatePreview per incloure conversiÃ³ d'emojis
function updatePreview() {
    if (previewVisible) {
        const editorContent = document.getElementById('editor').value;
        const preview = document.getElementById('preview');
        
        // Primer processar el Markdown
        let htmlContent = marked.parse(editorContent);
        
        // DesprÃ©s convertir els emojis
        htmlContent = convertEmojis(htmlContent);
        
        preview.innerHTML = htmlContent;
    }
}
// FunciÃ³ per inserir shortcode d'emoji
function insertEmojiShortcode(shortcode) {
    insertText(shortcode);
    // ForÃ§ar actualitzaciÃ³ de la vista prÃ¨via
    setTimeout(updatePreview, 10);
}

// FunciÃ³ alternativa per al dropdown que insereix shortcodes
function createEmojiShortcodeButton(emoji, shortcode, title) {
    return `<button onclick="insertEmojiShortcode('${shortcode}'); closeDropdown('emojiDropdown')" 
                    class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg" 
                    title="${title} (${shortcode})">${emoji}</button>`;
}

// Exemple d'Ãºs per al dropdown amb shortcodes
function showEmojiShortcodes() {
    // Aquest Ã©s un exemple de com podries modificar el dropdown
    // per inserir shortcodes en lloc d'emojis directes
    const emojiHTML = `
        ${createEmojiShortcodeButton('âš ï¸', ':warning:', 'AdvertÃ¨ncia')}
        ${createEmojiShortcodeButton('ğŸ’¡', ':bulb:', 'Bombeta')}
        ${createEmojiShortcodeButton('ğŸ”¥', ':fire:', 'Foc')}
        ${createEmojiShortcodeButton('ğŸš€', ':rocket:', 'Coet')}
        ${createEmojiShortcodeButton('ğŸ›', ':bug:', 'Error')}
        ${createEmojiShortcodeButton('âœ…', ':white_check_mark:', 'Marcat')}
        ${createEmojiShortcodeButton('âŒ', ':x:', 'X')}
        ${createEmojiShortcodeButton('â—', ':exclamation:', 'ExclamaciÃ³')}
    `;
    return emojiHTML;
}

        // Inicialitzar l'editor
        document.addEventListener('DOMContentLoaded', async function() {

            initializeTheme()

            new TooltipManager();
            // Comprovar si cal mostrar documents d'exemple
            await checkExampleDocuments();
            
            // Configurar drag & drop
            setupDragAndDrop();
            
            updatePreview();
            
            // Detectar canvis de mida de pantalla per ajustar el layout responsiu
            window.addEventListener('resize', function() {
                // ForÃ§ar actualitzaciÃ³ del layout responsive
                if (previewVisible) {
                    const mainContent = document.getElementById('mainContent');
                    const editorContainer = document.getElementById('editorContainer');
                    const previewContainer = document.getElementById('previewContainer');
                    const editor = document.getElementById('editor');
                    
                    // Reassignar classes per assegurar responsivitat
                    editorContainer.className = 'w-full lg:w-1/2 bg-white border-r transition-all duration-300 flex flex-col min-h-0';
                    previewContainer.className = 'w-full lg:w-1/2 bg-white transition-all duration-300 flex flex-col min-h-0';
                    mainContent.className = 'flex flex-col lg:flex-row flex-1 overflow-hidden relative';
                    editor.className = 'w-full flex-1 p-4 border-none outline-none resize-none editor-textarea min-h-[60vh] lg:min-h-0';
                }
            });
        });

        // Comprovar i gestionar documents d'exemple
        async function checkExampleDocuments() {
            const userPreference = localStorage.getItem('skipExampleDocs');
            
            if (userPreference === 'true') {
                // L'usuari ha dit que no vol exemples, deixar l'editor buit
                return;
            }
            
            const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
            const hasExistingDocs = Object.keys(savedDocs).length > 0;
            const editorHasContent = document.getElementById('editor').value.trim() !== '';
            
            if (!hasExistingDocs && !editorHasContent) {
                // Preguntar a l'usuari si vol documents d'exemple
                const wantsExamples = await showConfirm(
                    'Vols que afegim alguns documents d\'exemple per comenÃ§ar?<br><br>' +
                    'ğŸ’¡ Els documents d\'exemple t\'ajudaran a entendre com funciona l\'editor.',
                    'SÃ­, afegir exemples',
                    'No, comenÃ§ar buit'
                );
                
                if (wantsExamples) {
                    // Afegir documents d'exemple
                    addExampleDocuments();
                    // Carregar el primer document d'exemple
                    const exampleDoc = `# Benvingut a l'Editor de Markdown!

Aquest Ã©s un document d'exemple per mostrar-te les capacitats de l'editor.

## âœ¨ CaracterÃ­stiques principals

- **Vista prÃ¨via en temps real** mentre escrius
- **Barra d'eines completa** per a tots els elements Markdown
- **Emmagatzematge local** i exportaciÃ³ a fitxers
- **Disseny responsiu** que funciona en mÃ²bils
- **Drag & Drop** per obrir fitxers fÃ cilment

## ğŸ› ï¸ Elements que pots utilitzar

### Text amb format
Pots utilitzar **text en negreta**, *text en cursiva*, ~~text ratllat~~ i \`codi inline\`.

### Llistes
- Element 1
- Element 2
  - Sub-element
  - Un altre sub-element

### Llistes numeradas
1. Primer element
2. Segon element
3. Tercer element

### Llistes de tasques
- [x] Tasca completada
- [ ] Tasca pendent
- [ ] Una altra tasca

### Codi
\`\`\`javascript
function salutacio() {
    console.log("Hola, mÃ³n!");
}
salutacio();
\`\`\`

### Taules
| Funcionalitat | DescripciÃ³ | Estat |
|---------------|------------|-------|
| Editor | Escriptura de Markdown | âœ… |
| Vista prÃ¨via | RenderitzaciÃ³ HTML | âœ… |
| Drag & Drop | Obrir fitxers | âœ… |

### Cites
> "La millor manera d'aprendre Markdown Ã©s practicant."
> 
> â€” Un usuari satisfet

### EnllaÃ§os
Pots crear [enllaÃ§os a webs externes](https://example.com) o referÃ¨ncies internes.

---

## ğŸš€ ComenÃ§a a editar!

Prova la barra d'eines de dalt, arrossega fitxers a l'editor, o simplement comenÃ§a a escriure. 

**Consell:** Utilitza el botÃ³ ğŸ‘ï¸ per amagar aquesta vista prÃ¨via si necessites mÃ©s espai.`;
                    
                    document.getElementById('editor').value = exampleDoc;
                    updatePreview();
                } else {
                    // L'usuari no vol exemples, recordar aquesta decisiÃ³
                    localStorage.setItem('skipExampleDocs', 'true');
                }
            }
        }

        // Afegir documents d'exemple al Local Storage
        function addExampleDocuments() {
            const exampleDocs = {
                'exemple-basic.md': {
                    content: '# Document d\'exemple\n\nAquest Ã©s un document d\'exemple per provar l\'editor.\n\n## CaracterÃ­stiques\n\n- **Negreta** i *cursiva*\n- Llistes\n- [EnllaÃ§os](https://example.com)\n\n```javascript\n// Codi d\'exemple\nconsole.log("Hola mÃ³n!");\n```',
                    lastModified: new Date().toISOString()
                },
                'notes-personals.md': {
                    content: '# Notes personals\n\n## Tasques pendents\n\n- [ ] Revisar editor\n- [ ] Afegir mÃ©s funcions\n- [x] Provar Local Storage\n\n## Ideas\n\n> L\'editor de Markdown Ã©s molt Ãºtil per prendre notes rÃ pides.\n\nPuc guardar documents tant al disc dur com al Local Storage.',
                    lastModified: new Date(Date.now() - 86400000).toISOString() // 1 dia abans
                },
                'guia-markdown.md': {
                    content: '# Guia rÃ pida de Markdown\n\n## TÃ­tols\n```\n# TÃ­tol 1\n## TÃ­tol 2\n### TÃ­tol 3\n```\n\n## Format de text\n- **Negreta**: `**text**`\n- *Cursiva*: `*text*`\n- ~~Ratllat~~: `~~text~~`\n- `Codi`: `` `text` ``\n\n## Llistes\n```\n- Element 1\n- Element 2\n\n1. Element 1\n2. Element 2\n```\n\n## EnllaÃ§os\n```\n[Text](URL)\n```',
                    lastModified: new Date(Date.now() - 172800000).toISOString() // 2 dies abans
                }
            };
            localStorage.setItem('markdownDocs', JSON.stringify(exampleDocs));
        }

        function resolveModal(value) {
            if (currentModalResolve) {
                const resolve = currentModalResolve;
                currentModalResolve = null;
                hideModal();
                resolve(value);
            }
        }

        // Actualitzar vista prÃ¨via
        function updatePreview() {
            if (previewVisible) {
                const editorContent = document.getElementById('editor').value;
                const preview = document.getElementById('preview');

                console.log("ğŸš€ ~ updatePreview ~ marked:", marked)
                preview.innerHTML = marked.parse(editorContent);
                
            }
        }

        // Inserir text a la posiciÃ³ del cursor
        function insertText(text) {
            const editor = document.getElementById('editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const currentValue = editor.value;
            
            editor.value = currentValue.substring(0, start) + text + currentValue.substring(end);
            editor.selectionStart = editor.selectionEnd = start + text.length;
            editor.focus();
            updatePreview();
        }

        // Embolicar text seleccionat
        function wrapText(startText, endText) {
            const editor = document.getElementById('editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            const currentValue = editor.value;
            
            if (selectedText) {
                editor.value = currentValue.substring(0, start) + startText + selectedText + endText + currentValue.substring(end);
                editor.selectionStart = start + startText.length;
                editor.selectionEnd = start + startText.length + selectedText.length;
            } else {
                editor.value = currentValue.substring(0, start) + startText + endText + currentValue.substring(end);
                editor.selectionStart = editor.selectionEnd = start + startText.length;
            }
            
            editor.focus();
            updatePreview();
        }

        // Importar fitxer
        async function importFile() {
            await showOpenDialog();
        }

        // Mostrar diÃ leg d'obertura
        async function showOpenDialog() {
            const location = await showLocationChoice('D\'on vols obrir el document?');
            if (!location) return;
            
            if (location === 'disk') {
                // Obrir des del disc dur - activar selector de fitxers
                document.getElementById('fileInput').click();
            } else {
                // Obrir del Local Storage
                await showLocalStorageDocuments();
            }
        }

        // Mostrar documents del Local Storage
        async function showLocalStorageDocuments() {
            try {
                const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
                const docNames = Object.keys(savedDocs);
                
                if (docNames.length === 0) {
                    await showAlert('No hi ha documents guardats al Local Storage.<br><br>ğŸ’¡ <strong>Consell:</strong> Desa primer algun document per poder-lo obrir desprÃ©s.', 'info');
                    return;
                }
                
                const selectedDoc = await showDocumentSelector(savedDocs, docNames, 'open');
                if (selectedDoc) {
                    await loadFromLocalStorage(selectedDoc);
                }
                
            } catch (error) {
                await showAlert('Error en llegir del Local Storage: ' + error.message, 'error');
            }
        }

        // Selector de documents
        function showDocumentSelector(savedDocs, docNames, action = 'open') {
            return new Promise((resolve) => {
                let docList = '<div class="max-h-64 overflow-y-auto">';
                docNames.forEach((name, index) => {
                    const doc = savedDocs[name];
                    const lastModified = new Date(doc.lastModified).toLocaleString('ca-ES');
                    const actionText = action === 'open' ? 'Obrir' : 'Seleccionar';
                    docList += `
                        <div class="flex items-center justify-between p-3 border-b hover:bg-gray-50">
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">${name}</div>
                                <div class="text-sm text-gray-600">${lastModified}</div>
                            </div>
                            <button onclick="resolveModal('${name}')" 
                                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                ${actionText}
                            </button>
                        </div>
                    `;
                });
                docList += '</div>';

                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">ğŸ“„</span>
                            <h3 class="text-lg font-semibold text-gray-800">Documents guardats</h3>
                        </div>
                        ${docList}
                        <div class="flex justify-end mt-4">
                            <button onclick="resolveModal(null)" 
                                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                                CancelÂ·lar
                            </button>
                        </div>
                    </div>
                `;
                
                currentModalResolve = resolve;
                showModal(content);
            });
        }

        // Carregar document del Local Storage
        async function loadFromLocalStorage(fileName) {
            try {
                const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
                const doc = savedDocs[fileName];
                
                if (doc) {
                    document.getElementById('editor').value = doc.content;
                    updatePreview();
                    currentFileName = fileName;
                    await showAlert(`Document "${fileName}" carregat correctament.`, 'success');
                } else {
                    await showAlert('Document no trobat.', 'error');
                }
            } catch (error) {
                await showAlert('Error en carregar del Local Storage: ' + error.message, 'error');
            }
        }

        // Gestionar importaciÃ³ de fitxer
        async function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Comprovar si l'editor tÃ© contingut
            const currentContent = document.getElementById('editor').value.trim();
            let shouldReplace = true;
            
            if (currentContent) {
                shouldReplace = await showConfirm(
                    `L'editor ja tÃ© contingut. Vols substituir-lo pel contingut del fitxer "${file.name}"?<br><br>` +
                    'âš ï¸ <strong>AtenciÃ³:</strong> El contingut actual es perdrÃ  si no l\'has desat.',
                    'SÃ­, substituir',
                    'CancelÂ·lar'
                );
            }
            
            if (shouldReplace) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    document.getElementById('editor').value = e.target.result;
                    updatePreview();
                    currentFileName = file.name;
                    await showAlert(`Fitxer "${file.name}" carregat correctament.`, 'success');
                };
                reader.readAsText(file);
            }
            
            // Netejar l'input per permetre seleccionar el mateix fitxer de nou
            event.target.value = '';
        }

        // Exportar fitxer
        async function exportFile() {
            await showSaveDialog();
        }

        // Mostrar diÃ leg de desament
        async function showSaveDialog() {
            const content = document.getElementById('editor').value;
            if (!content.trim()) {
                await showAlert('No hi ha contingut per desar.', 'warning');
                return;
            }

            const fileName = await showPrompt('Nom del fitxer:', currentFileName, 'document.md');
            if (!fileName) return;

            const location = await showLocationChoice('On vols desar el document?');
            if (!location) return;
            
            if (location === 'disk') {
                // Desar al disc dur
                saveToFile(content, fileName);
            } else {
                // Desar al Local Storage
                await saveToLocalStorage(content, fileName);
            }
        }

        // Desar al disc dur
        function saveToFile(content, fileName) {
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName.endsWith('.md') ? fileName : fileName + '.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            currentFileName = fileName;
        }

        // Desar al Local Storage
        async function saveToLocalStorage(content, fileName) {
            try {
                // Obtenir llista de documents guardats
                const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
                
                // Afegir o actualitzar document
                savedDocs[fileName] = {
                    content: content,
                    lastModified: new Date().toISOString()
                };
                
                // Guardar al Local Storage
                localStorage.setItem('markdownDocs', JSON.stringify(savedDocs));
                
                currentFileName = fileName;
                await showAlert(`Document "${fileName}" desat al Local Storage correctament.`, 'success');
            } catch (error) {
                await showAlert('Error en desar al Local Storage: ' + error.message, 'error');
            }
        }

        // Netejar editor
        async function clearEditor() {
            const confirmed = await showConfirm('EstÃ s segur que vols netejar tot el contingut?', 'SÃ­, netejar', 'CancelÂ·lar');
            if (confirmed) {
                document.getElementById('editor').value = '';
                updatePreview();
                currentFileName = 'document.md';
            }
        }

        // Gestor del Local Storage
        async function showLocalStorageManager() {
            try {
                const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
                const docNames = Object.keys(savedDocs);
                
                if (docNames.length === 0) {
                    await showAlert('No hi ha documents guardats al Local Storage.', 'info');
                    return;
                }
                
                await showStorageManager(savedDocs, docNames);
                
            } catch (error) {
                await showAlert('Error en gestionar el Local Storage: ' + error.message, 'error');
            }
        }

        // InterfÃ­cie del gestor d'emmagatzematge
        function showStorageManager(savedDocs, docNames) {
            return new Promise((resolve) => {
                let docList = '<div class="max-h-64 overflow-y-auto mb-4">';
                docNames.forEach((name, index) => {
                    const doc = savedDocs[name];
                    const lastModified = new Date(doc.lastModified).toLocaleString('ca-ES');
                    docList += `
                        <div class="flex items-center justify-between p-3 border-b hover:bg-gray-50">
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">${name}</div>
                                <div class="text-sm text-gray-600">${lastModified}</div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="loadDocument('${name}')" 
                                        class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                    Carregar
                                </button>
                                <button onclick="deleteDocument('${name}')" 
                                        class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                });
                docList += '</div>';

                const content = `
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">ğŸ“‹</span>
                            <h3 class="text-lg font-semibold text-gray-800">GestiÃ³ de documents</h3>
                        </div>
                        ${docList}
                        <div class="flex justify-between">
                            <button onclick="clearAllDocuments()" 
                                    class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                                ğŸ—‘ï¸ Eliminar tots
                            </button>
                            <button onclick="hideModal(); modalResolve(null)" 
                                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                                Tancar
                            </button>
                        </div>
                    </div>
                `;
                
                modalResolve = resolve;
                showModal(content);
                
                // Funcions globals per als botons del modal
                window.loadDocument = async (name) => {
                    hideModal();
                    await loadFromLocalStorage(name);
                };
                
                window.deleteDocument = async (name) => {
                    const confirmed = await showConfirm(`EstÃ s segur que vols eliminar "${name}"?`, 'SÃ­, eliminar', 'CancelÂ·lar');
                    if (confirmed) {
                        await deleteFromLocalStorage(name);
                        // Recarregar el gestor
                        setTimeout(() => showLocalStorageManager(), 100);
                    } else {
                        // Tornar al gestor
                        setTimeout(() => showLocalStorageManager(), 100);
                    }
                };
                
                window.clearAllDocuments = async () => {
                    const confirmed = await showConfirm('EstÃ s segur que vols eliminar tots els documents del Local Storage?', 'SÃ­, eliminar tot', 'CancelÂ·lar');
                    if (confirmed) {
                        localStorage.removeItem('markdownDocs');
                        await showAlert('Tots els documents han estat eliminats.', 'success');
                    } else {
                        // Tornar al gestor
                        setTimeout(() => showLocalStorageManager(), 100);
                    }
                };
            });
        }

        // Eliminar document del Local Storage
        async function deleteFromLocalStorage(docName) {
            try {
                const savedDocs = JSON.parse(localStorage.getItem('markdownDocs') || '{}');
                
                if (savedDocs[docName]) {
                    delete savedDocs[docName];
                    localStorage.setItem('markdownDocs', JSON.stringify(savedDocs));
                    await showAlert(`Document "${docName}" eliminat correctament.`, 'success');
                } else {
                    await showAlert('Document no trobat.', 'error');
                }
            } catch (error) {
                await showAlert('Error en eliminar del Local Storage: ' + error.message, 'error');
            }
        }

        // Dreceres de teclat
        document.getElementById('editor').addEventListener('keydown', async function(e) {
            // Ctrl+B per negreta
            if (e.ctrlKey && e.key === 'b') {
                e.preventDefault();
                wrapText('**', '**');
            }
            // Ctrl+I per cursiva
            else if (e.ctrlKey && e.key === 'i') {
                e.preventDefault();
                wrapText('*', '*');
            }
            // Ctrl+S per desar
            else if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                await exportFile();
            }
            // Ctrl+O per obrir
            else if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                await importFile();
            }
            // Tab per indentar
            else if (e.key === 'Tab') {
                e.preventDefault();
                insertText('    ');
            }
        });
    </script>
</body>
</html>